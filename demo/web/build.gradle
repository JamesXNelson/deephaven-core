import com.bmuschko.gradle.docker.tasks.image.DockerBuildImage

plugins {
    id 'base'
    id 'com.bmuschko.docker-remote-api'
}

evaluationDependsOn ':web-client-ide'

def dockerfileDir = project.layout.buildDirectory.dir('prepareDocker')

def prepareDocker = project.tasks.register('prepareDocker', Sync) {
    it.from 'src/main/docker/Dockerfile'
    it.from('src/main/layouts') {
        into 'layouts'
    }
    it.from('src/main/notebooks') {
        into 'notebooks'
    }
    it.into dockerfileDir
}

def buildDocker = project.tasks.register('buildDocker', DockerBuildImage) {
    it.dependsOn prepareDocker, project(':web-client-ide').tasks.findByName('buildDocker')
    it.inputDir.set(dockerfileDir)
    it.buildArgs
    it.images.add('deephaven/demo-web:local-build')
}

assemble.dependsOn buildDocker